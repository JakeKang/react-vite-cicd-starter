# 환경별 환경 변수 설정

## 파일 구조
```
.env.example       # 템플릿 (Git 커밋)
.env.development   # 개발 환경 (Git 무시)
.env.production    # 프로덕션 환경 (Git 무시)
.env.test         # 테스트 환경 (Git 무시)
.env.local        # 로컬 개발자용 (Git 무시)
```

---

## .env.example (템플릿)
```bash
# Environment Variables Template
# 복사하여 사용: cp .env.example .env.development

# =====================================
# API 설정
# =====================================
VITE_API_URL=http://localhost:4000

# =====================================
# 마이크로 앱 URL
# =====================================
VITE_FEATURE_A_URL=http://localhost:3001
VITE_FEATURE_B_URL=http://localhost:3002
VITE_FEATURE_C_URL=http://localhost:3003

# =====================================
# 앱 설정
# =====================================
VITE_APP_NAME=main-app
VITE_APP_VERSION=1.0.0
VITE_BASE_PATH=/

# =====================================
# 기능 플래그 (선택)
# =====================================
VITE_FEATURE_AUTH=true
VITE_FEATURE_ANALYTICS=false

# =====================================
# 외부 서비스 (선택)
# =====================================
VITE_GOOGLE_ANALYTICS_ID=
VITE_SENTRY_DSN=
```

---

## .env.development (개발 환경)
```bash
# Development Environment

VITE_API_URL=http://localhost:4000

# 로컬 개발 서버
VITE_FEATURE_A_URL=http://localhost:3001
VITE_FEATURE_B_URL=http://localhost:3002
VITE_FEATURE_C_URL=http://localhost:3003

VITE_APP_NAME=main-app
VITE_APP_VERSION=1.0.0-dev
VITE_BASE_PATH=/

# 개발 환경에서는 디버깅 활성화
VITE_DEBUG=true
VITE_FEATURE_AUTH=false
VITE_FEATURE_ANALYTICS=false

# 개발용 외부 서비스 (테스트 계정)
VITE_GOOGLE_ANALYTICS_ID=
VITE_SENTRY_DSN=
```

---

## .env.production (프로덕션 환경)
```bash
# Production Environment

VITE_API_URL=https://api.yourcompany.com

# 프로덕션 마이크로 앱
VITE_FEATURE_A_URL=https://yourcompany.com/feature-a
VITE_FEATURE_B_URL=https://yourcompany.com/feature-b
VITE_FEATURE_C_URL=https://yourcompany.com/feature-c

VITE_APP_NAME=main-app
VITE_APP_VERSION=1.0.0
VITE_BASE_PATH=/

# 프로덕션에서는 디버깅 비활성화
VITE_DEBUG=false
VITE_FEATURE_AUTH=true
VITE_FEATURE_ANALYTICS=true

# 프로덕션 외부 서비스
VITE_GOOGLE_ANALYTICS_ID=UA-XXXXXXXXX-X
VITE_SENTRY_DSN=https://xxx@sentry.io/xxx
```

---

## .env.test (테스트 환경)
```bash
# Test Environment

VITE_API_URL=http://localhost:4000

# 테스트용 Mock 서버
VITE_FEATURE_A_URL=http://localhost:3001
VITE_FEATURE_B_URL=http://localhost:3002
VITE_FEATURE_C_URL=http://localhost:3003

VITE_APP_NAME=main-app
VITE_APP_VERSION=1.0.0-test
VITE_BASE_PATH=/

# 테스트 환경 설정
VITE_DEBUG=true
VITE_FEATURE_AUTH=false
VITE_FEATURE_ANALYTICS=false

# 외부 서비스 비활성화
VITE_GOOGLE_ANALYTICS_ID=
VITE_SENTRY_DSN=
```

---

## package.json 스크립트 수정
```json
{
  "scripts": {
    "dev": "vite --mode development",
    "build": "vite build --mode production",
    "build:dev": "vite build --mode development",
    "build:staging": "vite build --mode staging",
    "preview": "vite preview",
    "test": "vitest --mode test"
  }
}
```

---

## Vite에서 환경 변수 로드 방식

Vite는 자동으로 다음 우선순위로 환경 변수를 로드합니다:

1. `.env.${mode}.local` (예: `.env.development.local`)
2. `.env.${mode}` (예: `.env.development`)
3. `.env.local`
4. `.env`

**예시:**
```bash
# 개발 서버 실행
npm run dev
# → .env.development 로드

# 프로덕션 빌드
npm run build
# → .env.production 로드

# 스테이징 빌드
npm run build:staging
# → .env.staging 로드
```

---

## .gitignore에 추가
```gitignore
# 환경 변수 파일 (로컬만)
.env.local
.env.development.local
.env.production.local
.env.test.local

# 실제 환경 변수 파일 (선택적)
.env.development
.env.production
.env.test
```

**주의**: 
- `.env.example`만 Git에 커밋
- 실제 값이 있는 파일은 절대 커밋하지 말 것

---

## Docker 빌드 시 환경 변수 주입

### Dockerfile
```dockerfile
# 빌드 인자로 환경 변수 받기
ARG VITE_API_URL
ARG VITE_BASE_PATH

# 환경 변수 설정
ENV VITE_API_URL=${VITE_API_URL}
ENV VITE_BASE_PATH=${VITE_BASE_PATH}

RUN npm run build
```

### docker-compose.yml
```yaml
services:
  main-app:
    build:
      context: .
      args:
        VITE_API_URL: https://api.yourcompany.com
        VITE_BASE_PATH: /
```

### GitLab CI/CD
```yaml
docker_build:
  script:
    - |
      docker build \
        --build-arg VITE_API_URL=https://api.yourcompany.com \
        --build-arg VITE_BASE_PATH=/ \
        -t app:latest .
```

---

## 사용 예시

### TypeScript에서 환경 변수 사용
```typescript
// src/config.ts
export const config = {
  apiUrl: import.meta.env.VITE_API_URL,
  appName: import.meta.env.VITE_APP_NAME,
  isDebug: import.meta.env.VITE_DEBUG === 'true',
  features: {
    auth: import.meta.env.VITE_FEATURE_AUTH === 'true',
    analytics: import.meta.env.VITE_FEATURE_ANALYTICS === 'true',
  },
};

// 타입 안전성
if (import.meta.env.DEV) {
  console.log('개발 모드:', config);
}
```

### 환경 변수 타입 정의
```typescript
// src/vite-env.d.ts
/// <reference types="vite/client" />

interface ImportMetaEnv {
  readonly VITE_API_URL: string;
  readonly VITE_APP_NAME: string;
  readonly VITE_APP_VERSION: string;
  readonly VITE_BASE_PATH: string;
  readonly VITE_DEBUG?: string;
  readonly VITE_FEATURE_AUTH?: string;
  readonly VITE_FEATURE_ANALYTICS?: string;
}

interface ImportMeta {
  readonly env: ImportMetaEnv;
}
```

---

## 보안 체크리스트

- [ ] `.env.*` 파일이 `.gitignore`에 있는지 확인
- [ ] `.env.example`만 Git에 커밋되었는지 확인
- [ ] 민감한 정보가 `VITE_` prefix를 사용하지 않는지 확인
- [ ] API 키, 비밀번호 등은 백엔드에서만 관리되는지 확인
- [ ] 프로덕션 환경 변수가 안전하게 저장되었는지 확인 (GitLab CI/CD Variables)
